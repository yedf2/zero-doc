<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="go-zero RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="go-zero Atom Feed">
<link rel="search" type="application/opensearchdescription+xml" title="go-zero" href="/en/opensearch.xml"><title data-react-helmet="true">Service Deployment | go-zero</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://zeromicro.github.io/en/docs/project/deploy"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Service Deployment | go-zero"><meta data-react-helmet="true" name="description" content="This section does a simple service deployment to k8s demo via jenkins."><meta data-react-helmet="true" property="og:description" content="This section does a simple service deployment to k8s demo via jenkins."><link data-react-helmet="true" rel="icon" href="/en/img/go-zero.svg"><link data-react-helmet="true" rel="canonical" href="https://zeromicro.github.io/en/docs/project/deploy"><link data-react-helmet="true" rel="alternate" href="https://zeromicro.github.io/docs/project/deploy" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://zeromicro.github.io/en/docs/project/deploy" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://zeromicro.github.io/docs/project/deploy" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/en/assets/css/styles.ebdda6f7.css">
<link rel="preload" href="/en/assets/js/runtime~main.e947d4da.js" as="script">
<link rel="preload" href="/en/assets/js/main.2f72096f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/go-zero.png" alt="Go-zero Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/en/img/go-zero.png" alt="Go-zero Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">Go-zero</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/docs/intro/brief">Docs</a><a class="navbar__item navbar__link" href="/en/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_EbrZ"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>English</span></span></a><ul class="dropdown__menu"><li><a href="/docs/project/deploy" target="_self" rel="noopener noreferrer" class="dropdown__link">中文</a></li><li><a href="/en/docs/project/deploy" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">English</a></li></ul></div><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">🌜</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">🌞</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div><div class="searchBox_Utm0"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/intro/brief">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/quick-start/concept">Quick Start</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/build-tool/tool-intro">Build Tool</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/component/rest">Components</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/other-component/go-queue">Other Components</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/en/docs/project/prepare">Project</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/project/prepare">Preparation work</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/project/specification">Development Specifications</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/project/process">Development process</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/project/config">Configuration introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/project/business">Business Development</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/project/cicd">CI/CD</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/en/docs/project/deploy">Service Deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/en/docs/project/log">Log collection</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/ecology/intellij">Ecology</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/extension/shorturl">Extension</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/en/docs/problem/in-use">Problems</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Service Deployment</h1></header><p>This section does a simple service deployment to k8s demo via jenkins.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="preparation">Preparation<a class="hash-link" href="#preparation" title="Direct link to heading">​</a></h2><ul><li>k8s cluster installation</li><li>gitlab environment installation</li><li>jenkins environment installation</li><li>redis&amp;mysql&amp;nginx&amp;etcd installation</li><li>goctl installation</li></ul><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>goctl ensures that k8s is available on every node</p><p>Please google the above environment installation by yourself, no lengthy introduction here.</p></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="service-deployment-1">Service deployment<a class="hash-link" href="#service-deployment-1" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="1-gitlab-code-repository-related-preparation">1. gitlab code repository related preparation<a class="hash-link" href="#1-gitlab-code-repository-related-preparation" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="11-add-ssh-key">1.1. Add SSH Key<a class="hash-link" href="#11-add-ssh-key" title="Direct link to heading">​</a></h4><p>Go to gitlab, click User Center, find <code>Settings</code>, find <code>SSH Keys</code> tab on the left side
! <a target="_blank" href="/en/assets/files/ssh-add-key-1fc91c396e8e927e4345207f6cfb1869.png">ssh key</a></p><ul><li><ol><li>View the public key on the machine where jenkins is located</li></ol></li></ul><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> ~/.ssh/id_rsa.pub</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><ol start="2"><li>If not, you need to generate it, if it exists, skip to step 3</li></ol></li></ul><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh-keygen -t rsa -b </span><span class="token number" style="color:#36acaa">2048</span><span class="token plain"> -C </span><span class="token string" style="color:#e3116c">&quot;email@example.com&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><blockquote><p>&quot;<a href="mailto:email@example.com" target="_blank" rel="noopener noreferrer">email@example.com</a>&quot; can be replaced with your own email</p><p>After finishing the generation, repeat the first step</p></blockquote><ul><li><ol start="3"><li>Add the public key to gitlab</li></ol></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="12-upload-the-code-to-the-gitlab-repository">1.2, upload the code to the gitlab repository<a class="hash-link" href="#12-upload-the-code-to-the-gitlab-repository" title="Direct link to heading">​</a></h4><p>Create a new project <code>go-zero-demo</code> and upload the code, no details are described here.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="2-jenkins">2. jenkins<a class="hash-link" href="#2-jenkins" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="21add-credentials">2.1、Add credentials<a class="hash-link" href="#21add-credentials" title="Direct link to heading">​</a></h4><ul><li>Check the private key of the machine where jenkins is located, corresponding to the previous gitlab public key</li></ul><div class="codeBlockContainer_J+bg language-shell theme-code-block"><div class="codeBlockContent_csEI shell"><pre tabindex="0" class="prism-code language-shell codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> id_rsa</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><p>Go to jenkins and click <code>Manage Jenkins</code>-&gt; <code>Manage Credentials</code> in order
! <a target="_blank" href="/en/assets/files/jenkins-credentials-67c5d02d364de9ce359864a183f9dbb2.png">credentials</a></p></li><li><p>Go to the <code>Global Credentials</code> page, add credentials, <code>Username</code> is an identifier, after adding the pipeline you know that this identifier is the credentials on behalf of gitlab on the line, Private Key<code> that is, the private key obtained above
Private Key</code> is the private key obtained above! <a target="_blank" href="/en/assets/files/jenkins-add-credentials-6571e3a1892342babe2aff11383cd4cf.png">jenkins-add-credentials</a></p></li></ul><h4 class="anchor anchorWithStickyNavbar_y2LR" id="22-adding-global-variables">2.2. Adding global variables<a class="hash-link" href="#22-adding-global-variables" title="Direct link to heading">​</a></h4><p>Go to <code>Manage Jenkins</code>-&gt;<code>Configure System</code>, slide to the <code>Global Properties</code> entry, add information about the docker private repository, such as <code>docker user name</code>, <code>docker user password</code>, <code>docker private repository address</code> as shown here
! <a target="_blank" href="/en/assets/files/docker_env-041478b5f3401eaa8984c63a0b0eb39d.png">docker_server</a></p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p><code>docker_user</code> change to your docker username</p><p><code>docker_pass</code> change to your docker user password</p><p><code>docker_server</code> change to your docker server address</p><p>Here I use a private repository, if there is no cloud vendor to provide a private repository to use, you can build a private repository by yourself, here will not repeat, we google.</p></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="23-configure-git">2.3. Configure git<a class="hash-link" href="#23-configure-git" title="Direct link to heading">​</a></h4><p>Go to <code>Manage Jenkins</code>-&gt;<code>Global Tool Configureation</code>, find the Git entry, fill in the path of the git executable on the machine where jenkins is located, if not, you need to download the Git plugin in jenkins plugin management.
! <a target="_blank" href="/en/assets/files/jenkins-git-2704493865e8f639ed334c1db8ce48a9.png">jenkins-git</a></p><p>! <a target="_blank" href="/en/assets/files/jenkins-configure-67327d264092ef27617d7f04d1d4383a.png">jenkins-configure</a></p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="24-adding-a-pipeline">2.4. Adding a Pipeline<a class="hash-link" href="#24-adding-a-pipeline" title="Direct link to heading">​</a></h4><blockquote><p>pipeline is used to build the project, pulling code from gitlab -&gt; generating Dockerfile -&gt; deploying to k8s are all done in this step, here is the demo environment, to ensure smooth deployment process
To ensure a smooth deployment process, you need to install jenkins on the machine where one of the nodes in the k8s cluster is located, I installed it on the master here.</p></blockquote><ul><li><p>Get the credentials id Go to the credentials page and find the credentials id with Username as <code>gitlab</code>
! <a target="_blank" href="/en/assets/files/jenkins-credentials-id-375cada8d4e2bc0b9595ea1075115037.png">jenkins-credentials-id</a></p></li><li><p>Go to the jenkins home page and click <code>New Item</code> with the name <code>user</code>
! <a target="_blank" href="/en/assets/files/jenkins-new-item-c75773b46b1a19c8497bfa7e2ec44052.png">jenkins-add-item</a></p></li><li><p>View the project git address
! <a target="_blank" href="/en/assets/files/gitlab-git-url-f1da68812c259d6a79ae1d6d56dbcb2e.png">gitlab-git-url</a></p></li><li><p>Add the service type Choice Parameter, check <code>This project is parameterized in General
</code>, click <code>Add Parameter</code> and select <code>Choice Parameter</code>, add the selected value constants (api, rpc) and the variables (type) to receive the values according to the diagram, which will be used later in the Pipeline script.
! <a target="_blank" href="/en/assets/files/jenkins-choice-74208d911d8e87e8b3c334623f622b76.png">jenkins-choice-parameter</a></p></li><li><p>Configure <code>user</code>, on the <code>user</code> configuration page, scroll down and find <code>Pipeline script</code>, fill in the script content</p></li></ul><div class="codeBlockContainer_J+bg language-text theme-code-block"><div class="codeBlockContent_csEI text"><pre tabindex="0" class="prism-code language-text codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">pipeline {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  agent any</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  parameters {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      gitParameter name: &#x27;branch&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      type: &#x27;PT_BRANCH&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      branchFilter: &#x27;origin/(. *)&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      defaultValue: &#x27;master&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      selectedValue: &#x27;DEFAULT&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      sortMode: &#x27;ASCENDING_SMART&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      description: &#x27;Select the branch to build&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  stages {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;Service information&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;echo branch: $branch&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;echo build service type: ${JOB_NAME}-$type&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;check out&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              checkout([$class: &#x27;GitSCM&#x27;, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              branches: [[name: &#x27;$branch&#x27;]],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              doGenerateSubmoduleConfigurations: false, </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              extensions: [], </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              submoduleCfg: [],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              userRemoteConfigs: [[credentialsId: &#x27;${credentialsId}&#x27;, url: &#x27;${gitUrl}&#x27;]]])</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;get_commit_id&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              echo &#x27;get commit_id&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              git credentialsId: &#x27;${credentialsId}&#x27;, url: &#x27;${gitUrl}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              script {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  env.commit_id = sh(returnStdout: true, script: &#x27;git rev-parse --short HEAD&#x27;).trim()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;goctl version detection&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;/usr/local/bin/goctl -v&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;Dockerfile Build&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 sh &#x27;/usr/local/bin/goctl docker -go service/${JOB_NAME}/${type}/${JOB_NAME}.go&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 script{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     env.image = sh(returnStdout: true, script: &#x27;echo ${JOB_NAME}-${type}:${commit_id}&#x27;).trim()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 sh &#x27;echo image name: ${image}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 sh &#x27;docker build -t ${image} .&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;upload to image repository&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;/root/dockerlogin.sh&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;docker tag ${image} ${dockerServer}/${image}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;docker push ${dockerServer}/${image}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;deploy to k8s&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              script{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  env.deployYaml = sh(returnStdout: true, script: &#x27;echo ${JOB_NAME}-${type}-deploy.yaml&#x27;).trim()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  env.port=sh(returnStdout: true, script: &#x27;/root/port.sh ${JOB_NAME}-${type}&#x27;).trim()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;echo ${port}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;rm -f ${deployYaml}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;/usr/local/bin/goctl kube deploy -secret dockersecret -replicas 2 -nodePort 3${port} -requestCpu 200 -requestMem 50 -limitCpu 300 -limitMem 100 -name ${JOB_NAME}-${type} -namespace hey-go-zero -image ${dockerServer}/${image} -o ${deployYaml} -port ${port}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;/usr/bin/kubectl apply -f ${deployYaml}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      stage(&#x27;Clean&#x27;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          steps{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;docker rmi -f ${image}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              sh &#x27;docker rmi -f ${dockerServer}/${image}&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              cleanWs notFailBuild: true</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/zhoushuguang/zero-doc/tree/main/website/i18n/en/docusaurus-plugin-content-docs/current/project/deploy.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/en/docs/project/cicd"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">CI/CD</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/en/docs/project/log"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Log collection</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preparation" class="table-of-contents__link toc-highlight">Preparation</a></li><li><a href="#service-deployment-1" class="table-of-contents__link toc-highlight">Service deployment</a><ul><li><a href="#1-gitlab-code-repository-related-preparation" class="table-of-contents__link toc-highlight">1. gitlab code repository related preparation</a></li><li><a href="#2-jenkins" class="table-of-contents__link toc-highlight">2. jenkins</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/en/docs/intro/brief">docs</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://join.slack.com/t/go-zero/shared_invite/zt-10ruju779-BE4y6lQNB_R21samtyKTgA" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Chat Group<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/en/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/zeromicro/go-zero" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 go-zero.dev, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.e947d4da.js"></script>
<script src="/en/assets/js/main.2f72096f.js"></script>
</body>
</html>